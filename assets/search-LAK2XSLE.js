import{r as p,j as t}from"./index-Cr8WPmXE.js";function E(){const[c,j]=p.useState(""),[l,r]=p.useState(null),[d,n]=p.useState(null),[h,a]=p.useState(!1),[s,i]=p.useState({}),u=[{label:"姓名",key:"emp_name",type:"text"},{label:"性別",key:"gender",type:"text"},{label:"職等",key:"job_grade",type:"text"},{label:"電話",key:"phone",type:"text"},{label:"薪資",key:"salary",type:"number"},{label:"生日",key:"birth_date",type:"date"},{label:"入職日期",key:"hire_date",type:"date"},{label:"住址",key:"address",type:"text"}],b=async()=>{try{const o=await(await fetch(`php/employee_search.php?emp_id=${c}`)).json();a(!1),o.error==="none"?(r(null),n("查無此人，是否新增？")):o.error==="delete"?(r(null),n("此員工已刪除")):(r(o),n(null))}catch(e){console.error("查詢失敗",e),n("查詢失敗，請稍後再試")}},m=()=>{a(!0),i({...l})},f=()=>{for(let e of u)if(!s[e.key])return alert("所有欄位均為必填"),!1;return/^[0-9]+$/.test(s.phone)?!0:(alert("電話欄位僅可包含數字"),!1)},k=async()=>{if(f())try{const e=new FormData;Object.keys(s).forEach(x=>{x==="photo"&&s.photo instanceof File?e.append("photo",s.photo):e.append(x,s[x])});const y=await(await fetch("php/employee_update.php",{method:"POST",body:e})).json();y.success?(r({...s,photo:y.photo||s.photo}),a(!1),alert("資料更新成功")):alert(`資料更新失敗: ${y.error||"未知錯誤"}`)}catch(e){console.error("操作失敗",e),alert("操作失敗，請稍後再試")}},v=async()=>{try{(await(await fetch(`php/employee_delete.php?emp_id=${c}`)).json()).success?(r(null),n("查無此人"),alert("員工資料已刪除")):alert("刪除失敗")}catch(e){console.error("刪除失敗",e),alert("刪除失敗，請稍後再試")}},g=()=>{r(null),n(null),a(!0),i({emp_id:c,emp_name:"",gender:"",job_grade:"",phone:"",salary:"",birth_date:"",hire_date:"",address:"",photo:null})};return t.jsxs("div",{children:[t.jsx("h1",{children:"查詢員工資料"}),t.jsx("input",{type:"text",value:c,onChange:e=>j(e.target.value),placeholder:"輸入員工身分證字號"}),t.jsx("button",{onClick:b,children:"查詢"}),d&&t.jsxs("div",{children:[t.jsx("p",{style:{color:"red",fontSize:"24px",fontWeight:"bold"},children:d}),d.includes("是否新增")&&t.jsx("button",{onClick:g,children:"新增員工"})]}),(l||h)&&t.jsxs("div",{children:[t.jsx("h2",{children:h?"新增 / 編輯員工資料":"員工資料"}),h?t.jsxs("div",{children:[u.map(e=>t.jsxs("p",{children:[e.label,":"," ",t.jsx("input",{type:e.type,value:s[e.key]||"",onChange:o=>i({...s,[e.key]:o.target.value})})]},e.key)),t.jsxs("p",{children:["照片:"," ",t.jsx("input",{type:"file",onChange:e=>{const o=e.target.files[0];o&&i({...s,photo:o})}})]}),s.photo&&t.jsxs("div",{children:[t.jsx("p",{children:"照片預覽:"}),t.jsx("img",{src:s.photo instanceof File?URL.createObjectURL(s.photo):`photo/${s.photo}`,alt:"照片預覽",style:{width:"150px",objectFit:"cover",borderRadius:"8px"}})]}),t.jsx("button",{onClick:k,children:l?"保存":"新增"}),t.jsx("button",{onClick:()=>a(!1),children:"取消"})]}):t.jsxs("div",{children:[u.map(e=>t.jsxs("p",{children:[e.label,": ",l[e.key]]},e.key)),l.photo&&t.jsxs("div",{children:[t.jsx("p",{children:"照片:"}),t.jsx("img",{src:`photo/${l.photo}`,alt:"員工照片",style:{width:"150px",objectFit:"cover",borderRadius:"8px"}})]}),t.jsx("button",{onClick:m,children:"編輯"}),t.jsx("button",{onClick:v,children:"刪除"})]})]})]})}export{E as default};
