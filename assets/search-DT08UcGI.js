import{r as a,j as t}from"./index-Cr8WPmXE.js";function g(){const[i,x]=a.useState(""),[o,s]=a.useState(null),[p,c]=a.useState(null),[y,l]=a.useState(!1),[r,u]=a.useState({}),h=[{label:"國家名稱",key:"country_name",type:"text"},{label:"洲名",key:"continent_name",type:"text"},{label:"國家元首",key:"head_of_state",type:"text"},{label:"外交部長",key:"foreign_minister",type:"text"},{label:"聯絡人",key:"contact_person",type:"text"},{label:"人口數",key:"population",type:"number"},{label:"國土面積",key:"area",type:"number"},{label:"聯絡電話",key:"contact_phone",type:"text"},{label:"是否為盟友",key:"is_ally",type:"checkbox"}],k=async()=>{try{const n=await(await fetch(`php/country_search.php?country_code=${i}`)).json();l(!1),n.error==="none"?(s(null),c("查無此國家，是否新增？")):n.error==="delete"?(s(null),c("此國家已刪除")):(s(n),c(null))}catch(e){console.error("查詢失敗",e),c("查詢失敗，請稍後再試")}},b=()=>{l(!0),u({...o})},j=()=>{for(let n of h)if(n.type!=="checkbox"){const d=r[n.key];if(!d&&d!==0)return alert(`${n.label} 為必填`),!1}const e=r.country_code;return/^[A-Z]{2}\d{4}$/.test(e)?/^[0-9]+$/.test(r.contact_phone)?!0:(alert("電話欄位僅可包含數字"),!1):(alert("「國家代碼」必須符合前兩碼為大寫英文、後四碼為數字的格式，如 AA1234"),!1)},_=async()=>{if(!j())return;const e=o?"php/country_update.php":"php/country_add.php";try{(await(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json()).success?(s(r),l(!1),alert(o?"資料更新成功":"新增成功")):alert(o?"資料更新失敗":"新增失敗")}catch(n){console.error("操作失敗",n),alert(o?"資料更新失敗，請稍後再試":"新增失敗，請稍後再試")}},f=async()=>{try{(await(await fetch(`php/country_delete.php?country_code=${i}`)).json()).success?(s(null),c("查無此國家"),alert("國家資料已刪除")):alert("刪除失敗")}catch(e){console.error("刪除失敗",e),alert("刪除失敗，請稍後再試")}},C=()=>{s(null),c(null),l(!0),u({country_code:i,country_name:"",continent_name:"",head_of_state:"",foreign_minister:"",contact_person:"",population:"",area:"",contact_phone:"",is_ally:0})};return t.jsxs("div",{children:[t.jsx("h1",{children:"查詢國家資料"}),t.jsx("input",{type:"text",value:i,onChange:e=>x(e.target.value),placeholder:"輸入國家代碼"}),t.jsx("button",{onClick:k,children:"查詢"}),p&&t.jsxs("div",{children:[t.jsx("p",{style:{color:"red",fontSize:"24px",fontWeight:"bold"},children:p}),p.includes("是否新增")&&t.jsx("button",{onClick:C,children:"新增國家"})]}),(o||y)&&t.jsxs("div",{children:[t.jsx("h2",{children:y?"新增 / 編輯國家資料":"國家資料"}),y?t.jsxs("div",{children:[h.map(e=>t.jsxs("p",{children:[e.label,":"," ",e.type==="checkbox"?t.jsx("input",{type:"checkbox",checked:r[e.key]===1,onChange:n=>u({...r,[e.key]:n.target.checked?1:0})}):t.jsx("input",{type:e.type,value:r[e.key]||"",onChange:n=>u({...r,[e.key]:n.target.value})})]},e.key)),t.jsx("button",{onClick:_,children:o?"保存":"新增"}),t.jsx("button",{onClick:()=>l(!1),children:"取消"})]}):t.jsxs("div",{children:[h.map(e=>t.jsxs("p",{children:[e.label,":"," ",e.type==="checkbox"?o[e.key]===1?"是":"否":o[e.key]]},e.key)),t.jsx("button",{onClick:b,children:"編輯"}),t.jsx("button",{onClick:f,children:"刪除"})]})]})]})}export{g as default};
