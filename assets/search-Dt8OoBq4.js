import{r as n,j as t}from"./index-Cr8WPmXE.js";function v(){const[r,u]=n.useState(""),[h,d]=n.useState([]),[o,a]=n.useState(null),[c,i]=n.useState(!1),[l,p]=n.useState({}),y=[{label:"員工 ID",key:"emp_id",type:"text"},{label:"家庭成員 ID",key:"family_id",type:"text"},{label:"成員姓名",key:"family_name",type:"text"},{label:"性別",key:"family_gender",type:"text"},{label:"關係",key:"relationship",type:"text"},{label:"生日",key:"birth_date",type:"date"}],m=async()=>{try{const s=await(await fetch(`php/familymembers_search.php?id=${r}`)).json();i(!1),s.error==="none"?(d([]),a("查無此人，是否新增？")):s.error==="delete"?(d([]),a("已刪除")):(d(s),a(null))}catch(e){console.error("查詢失敗",e),a("查詢失敗，請稍後再試")}},x=e=>{i(!0),p({...e})},f=()=>{for(let e of y){const s=l[e.key];if(s===void 0||s==="")return alert("所有欄位均為必填"),!1}return!0},b=async()=>{if(!f())return;const e=l.family_id?"php/familymembers_update.php":"php/familymembers_add.php";try{(await(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).json()).success?(alert(l.family_id?"資料更新成功":"新增成功"),i(!1),m()):alert(l.family_id?"資料更新失敗":"新增失敗")}catch(s){console.error("操作失敗",s),alert(l.family_id?"資料更新失敗，請稍後再試":"新增失敗，請稍後再試")}},j=()=>{a(null),i(!0),p({emp_id:r,family_id:"",family_name:"",family_gender:"",relationship:"",birth_date:""})};return t.jsxs("div",{children:[t.jsx("h1",{children:"查詢眷屬資料"}),t.jsx("input",{type:"text",value:r,onChange:e=>u(e.target.value),placeholder:"輸入員工 ID"}),t.jsx("button",{onClick:m,children:"查詢"}),o&&t.jsxs("div",{children:[t.jsx("p",{style:{color:"red",fontSize:"24px",fontWeight:"bold"},children:o}),o.includes("是否新增")&&t.jsx("button",{onClick:j,children:"新增成員"})]}),(h.length>0||c)&&t.jsxs("div",{children:[t.jsx("h2",{children:c?"新增 / 編輯家庭成員":"家庭成員資料"}),c?t.jsxs("div",{children:[y.map(e=>t.jsxs("p",{children:[e.label,":"," ",t.jsx("input",{type:e.type,value:l[e.key]||"",readOnly:(e.key==="emp_id"||e.key==="family_id")&&l.family_id,onChange:s=>p({...l,[e.key]:s.target.value})})]},e.key)),t.jsx("button",{onClick:b,children:l.family_id?"保存":"新增"}),t.jsx("button",{onClick:()=>i(!1),children:"取消"})]}):t.jsx("div",{children:h.map(e=>t.jsxs("div",{style:{border:"1px solid #ccc",padding:"10px",margin:"10px 0"},children:[y.map(s=>t.jsxs("p",{children:[s.label,": ",e[s.key]]},s.key)),t.jsx("button",{onClick:()=>x(e),children:"編輯"})]},e.family_id))})]})]})}export{v as default};
